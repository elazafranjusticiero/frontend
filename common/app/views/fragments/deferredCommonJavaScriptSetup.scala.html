@(item: MetaData, bootstrapJsModule: String, switches: Seq[com.gu.management.Switchable])(implicit request: RequestHeader)

@import CommonSwitches.FontSwitch

<script id="gu">

    var guardian = {
            isModernBrowser: ('querySelector' in document && 'addEventListener' in window && 'localStorage' in window)
            }, 
            curl = {
                baseUrl: '@{Configuration.static.path}javascripts',
                apiName: 'require',
                paths: {
                    omniture: '@Static("javascripts/vendor/omniture.js")'
                }
            };

    (function(isModern) {

        if (!isModern) { return false; }

        guardian.config = {
            page: {

                @item.metaData.map{ data => @MetadataJson(data) }.mkString(","),

                @Configuration.javascript.config.map{ case (key, value) =>
                    '@{JavaScriptVariableName(key.split('.').last)}': '@value'
                }.mkString(","),

                @Configuration.javascript.pageData.map{ case (key, value) =>
                    '@{JavaScriptVariableName(key.split('.').last)}': '@value'
                }.mkString(","),

                'edition': '@Edition(request, Configuration)',
                'ajaxUrl': '@Configuration.edition.ajaxUrlFor(Edition(request, Configuration))'
            },
            switches : { @switches.map{ switch =>
                    '@{JavaScriptVariableName(switch.name)}': @{switch.isSwitchedOn}
                }.mkString(",")
            }
        };

        var script = document.createElement('script');
        script.async = 'async';
        script.src = '@Static("javascripts/bootstraps/app.js")';

        document.getElementsByTagName("head")[0].appendChild(script); 
    
    })(guardian.isModernBrowser);

</script>
